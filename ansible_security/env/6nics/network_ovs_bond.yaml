---
# nic1 \
#       +---ovs_bond0 ---> [internal_address]
# nic2 /   (ovs bond)
#
# nic3 \
#       +---ovs_bond2 ---> [storage_address]
# nic4 /   (ovs bond)
#
# nic5 \
#       +--- br-ex ---> [tenant]
# nic6 /   (ovs bond)
network_config:
  # Config api Network
  - type: ovs_bridge
    name: ovs_bond0
    use_dhcp: false
    members:
      - type: ovs_bond
        name: bond0
        use_dhcp: false
        members:
          - type: interface
            name: nic1
          - type: interface
            name: nic2
    addresses:
      - ip_netmask: "{{ internal_address }}/{{ internal_prefix }}"
{% if internal_gateway|bool %}
    routes:
      - ip_netmask: 0.0.0.0/0
        next_hop: "{{ internal_gateway }}"
        default: 'true'
{% endif %}

  # Config Storage Network
  - type: ovs_bridge
    name: ovs_bond1
    use_dhcp: false
    members:
      - type: ovs_bond
        name: bond1
        use_dhcp: false
        members:
          - type: interface
            name: nic3
          - type: interface
            name: nic4
    addresses:
      - ip_netmask: "{{ storage_address }}/{{ storage_prefix }}"

  # Config Tenant Network
  - type: ovs_bridge
    name: br-ex
    use_dhcp: false
    mtu: {{ tenant_mtu|int }}
    members:
      - type: ovs_bond
        name: bond2
        ovs_options: "bond_mode=balance-slb other_config:bond-miimon-interval=100"
        mtu: {{ tenant_mtu|int }}
        members:
          - type: interface
            name: nic5
          - type: interface
            name: nic6
